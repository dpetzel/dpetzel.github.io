<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="A collection of thoughts, discoveries, and ramblings I've bothered to document.">
        <meta name="viewport" content="width=device-width">
        <title>Publishing A Zenoss ZenPack to PyPi Using Travis-CI &mdash; Dave&#39;s Site</title>
            <link rel="stylesheet" href="../../../_static/normalize.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/sphinx.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/main.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/modern5.css" type="text/css">
            <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="../../../_static/webfont.css" type="text/css">
        <link rel="shortcut icon" href="../../../_static/tinkerer.ico" /><!-- Load modernizr and JQuery -->
        <script src="../../../_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="../../../_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="../../../_static/plugins.js"></script>
        <script src="../../../_static/main.js"></script>
        <link rel="next" title="Live With Mynt" href="../03/live_with_mynt.html" /><link rel="prev" title="Hello Pelican" href="../08/hello_pelican.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="../../../_static/underscore.js"></script><script type="text/javascript" src="../../../_static/doctools.js"></script><script type="text/javascript" src="../../../_static/disqus.js"></script><script type="text/javascript" src="../../../_static/google_analytics.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            // Adjusts document height if sidebar is taller
            var documentwrapper = document.getElementsByTagName("article")[0];
            var sidebar = document.getElementsByClassName("sidebar")[0];

            if (sidebar.offsetHeight > documentwrapper.offsetHeight)
            {
                var mainwrapper = document.getElementsByClassName("main")[0];
                documentwrapper.style.minHeight = mainwrapper.offsetHeight + "px";
            }

            // Scroll to content if on small screen
            if (screen.width < 480)
            {
                $(document).scrollTop(document.getElementsByTagName("article")[0].offsetTop - 44);
            }
        });
    </script></head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><header>
            <hgroup>
              <h1><a href="../../../index.html">Dave&#39;s Site</a></h1><h2>I Do Random Stuff And Occasionally Document It.</h2></hgroup>
          </header>
      <nav>
            <ul><li class="quicklink"><div class="rss">
        <a href="../../../rss.html" title="Subscribe via RSS"><span class="webfont">B</span></a>
    </div></li><li class="main-nav">
                  <a href="../../../index.html">Home</a>
                </li>
              <li class="main-nav">
                  <a href="../../../pages/about.html">About Me</a>
                </li>
              <li class="main-nav">
                  <a href="../../../pages/resume.html">Resume</a>
                </li>
              </ul>
          </nav><div class="main-container"><div class="main wrapper clearfix"><article><ul class="related clearfix">
            <li class="left"> &laquo; <a href="../08/hello_pelican.html">Hello Pelican</a></li>
            <li class="right"><a href="../03/live_with_mynt.html">Live With Mynt</a> &raquo; </li>
        </ul><div class="timestamp postmeta">
            <span>September 07, 2013</span>
        </div>
    <div class="section" id="publishing-a-zenoss-zenpack-to-pypi-using-travis-ci">
<h1>Publishing A Zenoss ZenPack to PyPi Using Travis-CI</h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>It was pointed out to me that while ZenPacks are technically eggs,
it is not always safe to promote them as a standard Python module, which is
why you don&#8217;t see more ZenPacks on PyPi.</p>
<p class="last">So read on if you are curious about how it <em>might</em> work, but please don&#8217;t
make this part of your standard ZenPack release process.</p>
</div>
<div id="more"> </div><p>I recently had the need to update the <a class="reference external" href="https://github.com/ZCA/ZenPacks.community.f5">F5 ZenPack</a>. It had been a while since
I had updated a Pack so I was hopeful that the process for releasing a new
pack (<a class="reference external" href="http://wiki.zenoss.org/Releasing_your_ZenPack">http://wiki.zenoss.org/Releasing_your_ZenPack</a>) had been updated to be
a little less manual. Don&#8217;t get me wrong the system that is in place is a vast
improvement of what used to exist, but I&#8217;m just not excited about how manual
the process is. Maybe I&#8217;ll write up a seperate page about what I dislike about
the process, but the focus on this page is not to complain about that process,
but rather show what I think is a better (more automatted) solution.</p>
<p>So the goal I set out was with:</p>
<ul class="simple">
<li>I didn&#8217;t want to continue to maintain two different versions of documentation
(I keep a README.rst with the pack, but the Wiki requires wiki markup)</li>
<li>I didn&#8217;t want to manually upload any build artifacts</li>
<li>I want to lay the ground work for some testing (I&#8217;ve historically done a poor
job at adding tests to my ZenPacks, but I&#8217;m hoping to change that)</li>
</ul>
<p>So I set out on the road of using <a class="reference external" href="https://travis-ci.org">Travis CI</a> uploading <a class="reference external" href="http://pypi.python.org">PyPi</a>. So the first
step I took was getting integration with PyPi`_ outside of Travis. After reading
up on the documentation at <a class="reference external" href="http://docs.python.org/3/distutils/packageindex.html">http://docs.python.org/3/distutils/packageindex.html</a></p>
<p>I added the following release.sh script to my ZenPacks repo:</p>
<div class="highlight-python"><pre>#! /bin/bash

# Create a .pypirc file in the home directory
echo "[distutils]
index-servers =
        pypi

[pypi]" &gt; ~/.pypirc

echo "username: " "$PYPI_USER" &gt;&gt; ~/.pypirc
echo "password: " "$PYPI_PWD" &gt;&gt; ~/.pypirc

python setup.py sdist bdist_egg upload
rm -f ~/.pypirc</pre>
</div>
<p>So what this does is read in my PyPi username and password from an environment
variable so I don&#8217;t need to keep them in the repo. Additionally if someone else
ever wants to become a contributor it should allow them to use the same script</p>
<p>I did a one time registration of the ZenPack outside of this script, and from
there on out, I&#8217;m able to just run <cite>sh release.sh</cite> from the root of the repo
and it will upload the compile compile egg (which contains the version) to PyPi.</p>
<p>So right out of the gate, I&#8217;ve hit two of my three targets. But I wanted to take
it a little further. While running <cite>sh release.sh</cite> is pretty easy, I wanted
to see about automatically testing and upload the egg. This is where things
got a little trickier, but still not to bad...</p>
<p>The <a class="reference external" href="https://travis-ci.org">Travis CI</a> getting started documentation is pretty indepth, so I don&#8217;t want
to recreate that here, but I do want to call out you&#8217;ll want to read up
how to do the encrypted environment stuff.</p>
<p>So after some trial and error (I&#8217;m not sure why, but it took me a while to krok
the encrypted environment variable stuff), I ended up with this <a class="reference external" href="https://github.com/ZCA/ZenPacks.community.f5/blob/master/.travis.yml">.travis.yml</a>.</p>
<p>So now everytime I push a change up to the github repo, a service hook fires
and <a class="reference external" href="https://travis-ci.org">Travis CI</a> starts building my ZenPack immediatly. You can see those build
resuts here: <a class="reference external" href="https://travis-ci.org/ZCA/ZenPacks.community.f5">https://travis-ci.org/ZCA/ZenPacks.community.f5</a></p>
<p>As part of the build process it will produce two egg files, one for Python2.6
(Zenoss 3.x) and one for Python 2.7 (Zenoss 4.x), and upload them automatically
to <a class="reference external" href="http://pypi.python.org">PyPi</a>.</p>
<p>I do have to say, I was not 100% comfortable with the idea of handing over some
much private information to Travis (allowing them access to my GitHub account,
as well as trusting that their encryption keys are secure). In the end, I just
ensured I was using information I don&#8217;t use on any other sites. I still
can&#8217;t say I&#8217;m entirely comfortable with it, but sometimes you just have to be
a little trusting. We&#8217;ll see....</p>
<p>The process did go smooth enough, that I intend to convert some of the other
ZenPacks I maintain and see how it goes longer term.</p>
</div>

    <div class="postmeta">
        <div class="author">
            <span>Posted by David Petzel</span>
        </div>
        <div class="categories">
            <span>
                Filed under:
                <a href="../../../categories/zenoss.html">Zenoss</a></span>
        </div>
        <div class="tags">
            <span>
                Tags:
                <a href="../../../tags/zenoss.html">Zenoss</a>, <a href="../../../tags/zenpack.html">ZenPack</a>, <a href="../../../tags/travis_ci.html">Travis-CI</a>, <a href="../../../tags/pypi.html">PyPi</a></span>
        </div>
        </div>
    <div id="disqus_thread"></div><script type="text/javascript">    var disqus_shortname = "dpetzel";    var disqus_identifier = "2013/09/07/publishing_a_zenoss_zenpack_to_pypi_using_travis_ci";    disqus_thread();</script><noscript>Please enable JavaScript to view the    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><ul class="related clearfix">
            <li class="left"> &laquo; <a href="../08/hello_pelican.html">Hello Pelican</a></li>
            <li class="right"><a href="../03/live_with_mynt.html">Live With Mynt</a> &raquo; </li>
        </ul></article><aside class="sidebar"><section><div class="widget">
    <h1>Recent Posts</h1>
    <ul><li>
            <a href="../../11/24/building_a_dell_t420_with_esxi_5.html">Building a Dell T420 with ESXi 5</a>
        </li><li>
            <a href="../../10/10/chromecast_woes.html">Chromecast Woes</a>
        </li><li>
            <a href="../../10/10/django_1_2_to_1_5_upgrade.html">Django 1.2 to 1.5 Upgrade</a>
        </li><li>
            <a href="../../10/03/chef_minitest_handler_cookbook_1_0_0_released.html">Chef Minitest Handler Cookbook 1.0.0 Released</a>
        </li><li>
            <a href="../24/sphinx_with_external_image_annoyance.html">Sphinx With External Image Annoyance</a>
        </li><li>
            <a href="../23/switched_to_tinkerer.html">Switched To Tinkerer</a>
        </li><li>
            <a href="../22/adventures_in_django_performance_analysis.html">Adventures in Django Performance Analysis</a>
        </li><li>
            <a href="../22/chef_minitest_and_slow_starting_web_application.html">Chef Minitest and Slow Starting Web Application</a>
        </li><li>
            <a href="../08/running_uptime_on_heroku.html">Running Uptime on Heroku</a>
        </li><li>
            <a href="../08/hello_pelican.html">Hello Pelican</a>
        </li></ul>
</div>
</section><section><div class="widget" id="searchbox">
    <h1>Search</h1>
    <form action="../../../search.html" method="get">
        <input type="text" name="q" />
        <button type="submit"><span class="webfont">L</span></button>
    </form>
</div></section></aside></div> <!-- #main --></div> <!-- #main-container -->

        <div class="footer-container"><footer class="wrapper">&copy; Copyright 2013, David Petzel. Powered by <a href="http://www.tinkerer.me/">Tinkerer</a> and <a href="http://sphinx.pocoo.org/">Sphinx</a>.</footer></div> <!-- footer-container -->

      </div> <!--! end of #container --><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->
    </body>
</html>