<!DOCTYPE html>

<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Dave&#39;s Site</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<!--[if lt IE 9]>
	<script src="http://www.dpetzel.info//js/html5.js"></script>
	<![endif]-->

    <link href="http://www.dpetzel.info//index.xml" rel="alternate" type="application/rss+xml" title="Dave&#39;s Site" />

    <link rel='stylesheet' id='twentyfourteen-lato-css'  href='//fonts.googleapis.com/css?family=Lato%3A300%2C400%2C700%2C900%2C300italic%2C400italic%2C700italic&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />

    <link rel='stylesheet' id='genericons-css' href='http://www.dpetzel.info//genericons/genericons.css' type='text/css' media='all' />
	<link rel='stylesheet' id='twentyfourteen-style-css' href='http://www.dpetzel.info//css/style.css' type='text/css' media='all' />
	
	<script type='text/javascript' src='http://www.dpetzel.info//js/jquery/jquery.js'></script>
	<script type='text/javascript' src='http://www.dpetzel.info//js/jquery/jquery-migrate.min.js'></script>
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>

	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css">
	<style type='text/css'>
	pre, code {
	    white-space: pre;
	    overflow-x: scroll;
			width: auto;
	}
	.hljs {
	    display: inline-block;
	    padding: 0.5em;
	    padding-right: 5%;
	    background: #002b36;
	    color: #839496;
	}
	</style>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>

<body class="home blog masthead-fixed list-view full-width grid">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<div class="header-main">
			<h1 class="site-title"><a href="http://www.dpetzel.info//index.html" rel="home">Dave&#39;s Site</a></h1>

			<div class="search-toggle">
				<a href="#search-container" class="screen-reader-text">Search</a>
			</div>

			<nav id="primary-navigation" class="site-navigation primary-navigation" role="navigation">
				<button class="menu-toggle">Primary Menu</button>
				<a class="screen-reader-text skip-link" href="#content">Skip to content</a>
				<div class="nav-menu">
					<ul>
						
						<li class="page_item">
							<a href="/about/">About Me</a>
						</li>
						
						<li class="page_item">
							<a href="/resume/">Resume</a>
						</li>
						
					</ul>
				</div>
			</nav>
		</div>

		<div id="search-container" class="search-box-wrapper hide">
			<div class="search-box">
                <script type="text/javascript">
    function site_search(obj) {
    	var host = window.location.host;
        obj.q.value = "site:" + host + " " + obj.ss_q.value;
    }
</script>

<aside id="search-3" class="widget widget_search">
	<form role="search" class="search-form" action="//www.google.com/search" method="get" onSubmit="site_search(this)">

	<input name="q" type="hidden" />
	    <label>
	        <span class="screen-reader-text">Search for:</span>
	        <input name="ss_q" type="text" placeholder="Search ..." class="search-field" />
	    </label>
	    <input type="submit" value="Search" class="search-submit" />
	</form>
</aside>
			</div>
		</div>
	</header>

	<div id="main" class="site-main">


<div id="main-content" class="main-content">

	<div id="primary" class="content-area">
		<div id="content" class="site-content" role="main">
			<div id="googleads" class="site-content" style="margin-left:200px;">
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  
  <ins class="adsbygoogle"
       style="display:inline-block;width:728px;height:90px"
       data-ad-client="ca-pub-3085354840505663"
       data-ad-slot="2904100968"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>


			<header class="archive-header">
				<h1 class="archive-title">Active Directory Archive</h1>
			</header>

			
				<article class="post type-post status-publish format-standard hentry">

	
	<header class="entry-header">

	


		<div class="entry-meta">
			<span class="cat-links">
                
                <a href="http://www.dpetzel.info//categories/system-administration/index.html" rel="category">System Administration</a>
                
			</span>
		</div>

		<h1 class="entry-title">Migrating from Windows 2003 SBS to Windows 2012 Standard Part I</h1>

		
		<div class="entry-meta">
			<span class="entry-date">
				<a href="http://www.dpetzel.info/post/migrating-from-windows-2003-sbs-to-windows-2012-standard-part-i//index.html" rel="bookmark">
					<time class="entry-date" datetime="2013-11-28 00:00:00 &#43;0000 UTC">
						November 28 2013
					</time>
				</a>
			</span>
		</div>
		

	</header>

	<div class="entry-content">
		

<p>I&rsquo;ve recently been tasked with migrating a Windows 2003 Small Business Server
to Windows 2013 Standard.</p>

<p>Without getting into too much of the back story, the client purchased Windows
2003 SBS many moons ago, however they never leveraged anything except Active
Directory and File Sharing. They use their hosting provider&rsquo;s web mail, and
don&rsquo;t have an appetite to change that.</p>

<p>Here are we many moons later and they are ready to upgrade. They&rsquo;ve purchased a
new, fairly beefy, box running Windows 2012 Standard.</p>

<p>After some discussions around the path they would prefer to take we&rsquo;ve decided
we don&rsquo;t want to have to touch all of the PCs and move them to a new domain,
and we&rsquo;d like the upgrade to be as seamless as possible. To that end the decision
was made to attempt a <em>migration</em>. This document will hopefully capture my
journey down this path. Its been at least 5 years since I&rsquo;ve touched a &laquo;real&raquo;
domain controller, so a decent amount of reading is order, but from what I have
gathered so far this is not a standard conversion path, but it appears there
are some options.</p>

<h2 id="getting-prepared">Getting Prepared</h2>

<p>So I decided I&rsquo;d blow away the existing installation of 2012 on the box and
lay down ESXi. I then re-installed 2012 fresh as a VM on the ESXi host. I also
performed a P2V on the existing Windows 2003 SBS host. The P2V process is
outside the scope of this document, but was actually pretty easy. This will
allow me to take snapshots, and even clone the VM for some trial runs
(I don&rsquo;t have any lab hardware available for this).</p>

<p>fter getting the SBS server virtualized, I proceed to configure the new 2013 box as a member server with a static IP. I ensured its primary DNS server was set to the SBS server. I did not configure any roles or features at all yet.</p>

<p>Now that I&rsquo;m ready to proceed, I started by installing the support tools
from <a href="http://www.microsoft.com/en-us/download/details.aspx?id=15326">http://www.microsoft.com/en-us/download/details.aspx?id=15326</a>. With those
tools in place I ran through series of tests as outlined in <a href="http://msmvps.com/blogs/mweber/archive/2012/07/30/upgrading-an-active-directory-domain-from-windows-server-2003-or-windows-server-2003-r2-to-windows-server-2012.aspx">http://msmvps.com/blogs/mweber/archive/2012/07/30/upgrading-an-active-directory-domain-from-windows-server-2003-or-windows-server-2003-r2-to-windows-server-2012.aspx</a></p>

<p>{% highlight console %}<br />
Dcdiag /v /c /d /e /s:<sbs_server> &gt; c:\temp\dcdiag.log
{% endhighlight %}</p>

<p>The first error logged was:
{% highlight console %}
    * Checking Service: IsmServ
        IsmServ Service is stopped on [SERVER]
    &hellip;&hellip;&hellip;&hellip;&hellip;&hellip;&hellip;&hellip; SERVER failed test Services
 {% endhighlight %}</p>

<p>Based <a href="http://blog.mpecsinc.ca/2008/07/sbs-dcdiag-produces-ismserv-error.html">http://blog.mpecsinc.ca/2008/07/sbs-dcdiag-produces-ismserv-error.html</a>,
it appears this is expected on SBS and safe to ignore, so doing just that.</p>

<p>The next error up was:</p>

<p>{% highlight console %}
      Starting test: systemlog
         * The System Event log test
         An Error Event occured.  EventID: 0xC0002719
            Time Generated: 11/28/2013   18:05:14
            (Event String could not be retrieved)
         &hellip;&hellip;&hellip;&hellip;&hellip;&hellip;&hellip;&hellip;. SERVER failed test systemlog
{% endhighlight %}</p>

<p>This seems to be related to a single event in my event log:</p>

<pre><code class="language-console">    Event Type: Error
    Event Source:   DCOM
    Event Category: None
    Event ID:   10009
    Date:       11/28/2013
    Time:       6:05:14 PM
    User:       N/A
    Computer:   SERVER
    Description:
    DCOM was unable to communicate with the computer sbs.ip.add.ress using any of the configured protocols.

    For more information, see Help and Support Center at http://go.microsoft.com/fwlink/events.asp.
</code></pre>

<p>I don&rsquo;t see any other occurrences of this error. I&rsquo;m assuming I could clear the
event logs to not see, but I&rsquo;d rather keep the event log history around, so I&rsquo;m
going to ignore this for now.</p>

<p>All the other tests passed, so I moved onto <code>Repadmin</code>:</p>

<pre><code class="language-console">Repadmin /showrepl sbs_host /verbose /all /intersite &gt;c:\repl.log
</code></pre>

<p>Nothing jumped out at me in this output. Next up <code>dnslint</code></p>

<pre><code class="language-console">  Dnslint /v /ad /s &quot;DCipaddress&quot;
</code></pre>

<p>This one caught something interesting:</p>

<pre><code class="language-console">Notes:
One or more DNS servers is not authoritative for the domain
</code></pre>

<p>After reviewing the output I found that at some point in time someone had
created a local host file entry for localhost that was the IP of the server.
Traditionally I believe localhost resolves to 127.0.0.1, rather than the actual
box IP, so I simply commented out the file entry. After that <code>dnslint</code> came
back clean.</p>

<p>I skipped the <code>adreplstatus</code> checks since this is a single node, and the tool
wanted me to install .net framework 4.0, which seemed heavy handed for a test
I didn&rsquo;t care about.</p>

<p>Next up I confirmed that both the <code>_msdcs.domain.local</code> and <code>domain.local</code> zones
were set to the <code>Active Directory-Integrated</code> type.</p>

<p>Next, I confirmed what level AD was currently at:</p>

<pre><code class="language-batch">Dsquery * cn=schema,cn=configuration,dc=domain,dc=local -scope base -attr objectVersion
</code></pre>

<p>This returned a value of <code>30</code> for me, which based on the link above means I&rsquo;m
at the <code>Windows Server 2003</code> which lines up with the version of SBS on the host.</p>

<p>At this point I took a snapshot of the host as we are going to start making
changes soon.</p>

<h2 id="upgrading">Upgrading</h2>

<h3 id="add-2012-server-as-new-domain-controller">Add 2012 Server As New Domain Controller</h3>

<p>In my case the SBS server was at the <code>Windows 2000</code> level for <strong>both</strong> the
Domain Functional Level, as well as the Forest Functional Level.
Using <code>Active Directory Domains and Trusts</code> I increased both of these to the
<code>Windows 2003</code> level. This was done on the SBS 2003 node. Since its a single
SBS box, I figure replication time is essentially 0 so after trolling the Event
Logs for a few minutes to ensure nothing weird popped up, I proceeded.</p>

<p>I then stepped through the process of promoting the 2012 as a domain controller
which is well illustrated at  <a href="http://blogs.technet.com/b/canitpro/archive/2013/05/05/step-by-step-adding-a-windows-server-2012-domain-controller-to-an-existing-windows-2003-network.aspx">http://blogs.technet.com/b/canitpro/archive/2013/05/05/step-by-step-adding-a-windows-server-2012-domain-controller-to-an-existing-windows-2003-network.aspx</a></p>

<p>After the restart I noticed a few things that seemed off at first. The first
one was that I didn&rsquo;t have a netlogon share on the new 2012 DC. Additionally
there were some errors in the event log. I found that the
<code>File Replication Service</code> was stopped. It was set to automatic, so I started
it. After starting that service, I now had the netlogon share as well.</p>

<h3 id="update-dns-clients">Update DNS Clients</h3>

<p>At this point I updated the DNS settings on thew new 2012 server to reference
itself first.</p>

<p>Once that was completed, I then update my DHCP configuration on the SBS 2003
box (I&rsquo;ll move DHCP later), I updated the options to pass the new box as the
primary DNS server.</p>

<h3 id="transferring-fsmo-roles">Transferring FSMO Roles</h3>

<p>I then followed <a href="http://blogs.technet.com/b/canitpro/archive/2013/05/27/step-by-step-active-directory-migration-from-windows-server-2003-to-windows-server-2012.aspx">http://blogs.technet.com/b/canitpro/archive/2013/05/27/step-by-step-active-directory-migration-from-windows-server-2003-to-windows-server-2012.aspx</a>
to transfer all the FSMO and related roles over to the new server.</p>

<h3 id="update-time-configurations">Update Time Configurations</h3>

<p>As touched on toward the end of the <a href="http://msmvps.com/blogs/mweber/archive/2012/07/30/upgrading-an-active-directory-domain-from-windows-server-2003-or-windows-server-2003-r2-to-windows-server-2012.aspx">http://msmvps.com/blogs/mweber/archive/2012/07/30/upgrading-an-active-directory-domain-from-windows-server-2003-or-windows-server-2003-r2-to-windows-server-2012.aspx</a> I updated time settings as follows</p>

<p>2012 Server:</p>

<pre><code class="language-batch">w32tm /config /manualpeerlist:time.windows.com /syncfromflags:manual /reliable:yes /update
</code></pre>

<p>SBS 2003 Server:</p>

<pre><code class="language-batch">w32tm /config /syncfromflags:domhier /reliable:no /update
</code></pre>

<p>At this point I&rsquo;m going to let things bake for a bit. I&rsquo;ve got all the &laquo;AD Stuff&raquo;
moved over. At this point I&rsquo;m left with all the file shares and applications
(IE Virus Console) that are configured to point at this host.  As I get to
moving some of these items I&rsquo;ll add new parts.</p>

<h2 id="references">References</h2>

<ul>
<li><a href="http://social.technet.microsoft.com/Forums/windowsserver/en-US/3f0062c8-80b1-4322-8a15-6529289fcc4b/migrate-ad-from-2003-to-2012">http://social.technet.microsoft.com/Forums/windowsserver/en-US/3f0062c8-80b1-4322-8a15-6529289fcc4b/migrate-ad-from-2003-to-2012</a></li>
<li><a href="http://msmvps.com/blogs/mweber/archive/2012/07/30/upgrading-an-active-directory-domain-from-windows-server-2003-or-windows-server-2003-r2-to-windows-server-2012.aspx">http://msmvps.com/blogs/mweber/archive/2012/07/30/upgrading-an-active-directory-domain-from-windows-server-2003-or-windows-server-2003-r2-to-windows-server-2012.aspx</a></li>
<li><a href="http://blogs.technet.com/b/canitpro/archive/2013/05/05/step-by-step-adding-a-windows-server-2012-domain-controller-to-an-existing-windows-2003-network.aspx">http://blogs.technet.com/b/canitpro/archive/2013/05/05/step-by-step-adding-a-windows-server-2012-domain-controller-to-an-existing-windows-2003-network.aspx</a></li>
<li><a href="http://blogs.technet.com/b/canitpro/archive/2013/05/27/step-by-step-active-directory-migration-from-windows-server-2003-to-windows-server-2012.aspx">http://blogs.technet.com/b/canitpro/archive/2013/05/27/step-by-step-active-directory-migration-from-windows-server-2003-to-windows-server-2012.aspx</a></li>
</ul>

	</div>

	<footer class="entry-meta">
		<span class="tag-links">
			
                <a href="http://www.dpetzel.info//tags/windows/index.html" rel="tag">windows</a>
            
                <a href="http://www.dpetzel.info//tags/small-business-server/index.html" rel="tag">small business server</a>
            
                <a href="http://www.dpetzel.info//tags/active-directory/index.html" rel="tag">active directory</a>
            
		</span>
	</footer>
</article> 

			

		</div>
	</div>
	<div id="secondary">

	

	<div id="primary-sidebar" class="primary-sidebar widget-area" role="complementary">

		<script type="text/javascript">
    function site_search(obj) {
    	var host = window.location.host;
        obj.q.value = "site:" + host + " " + obj.ss_q.value;
    }
</script>

<aside id="search-3" class="widget widget_search">
	<form role="search" class="search-form" action="//www.google.com/search" method="get" onSubmit="site_search(this)">

	<input name="q" type="hidden" />
	    <label>
	        <span class="screen-reader-text">Search for:</span>
	        <input name="ss_q" type="text" placeholder="Search ..." class="search-field" />
	    </label>
	    <input type="submit" value="Search" class="search-submit" />
	</form>
</aside>

		<aside id="recent-posts-3" class="widget widget_recent_entries">

	
	<h1 class="widget-title">Recent Posts</h1>
		<ul>
			
			<li>
				<a href="http://www.dpetzel.info/post/migrating-from-windows-2003-sbs-to-windows-2012-standard-part-i//index.html">Migrating from Windows 2003 SBS to Windows 2012 Standard Part I</a>
			</li>
			
		</ul>
	
</aside>

		<aside id="categories-3" class="widget widget_categories">
	
	<h1 class="widget-title">Categories</h1>

	<ul>
		
		
		
		<li class="cat-item">
			<a href="http://www.dpetzel.info//categories/chef/index.html">Chef</a>
		</li>

		
		
		<li class="cat-item">
			<a href="http://www.dpetzel.info//categories/hardware/index.html">Hardware</a>
		</li>

		
		
		<li class="cat-item">
			<a href="http://www.dpetzel.info//categories/programming/index.html">Programming</a>
		</li>

		
		
		<li class="cat-item">
			<a href="http://www.dpetzel.info//categories/system-administration/index.html">System-Administration</a>
		</li>

		
		
		<li class="cat-item">
			<a href="http://www.dpetzel.info//categories/tips/jekyll/index.html">Tips/Jekyll</a>
		</li>

		
		
		<li class="cat-item">
			<a href="http://www.dpetzel.info//categories/tips/python/index.html">Tips/Python</a>
		</li>

		
		
		<li class="cat-item">
			<a href="http://www.dpetzel.info//categories/tips/windows/index.html">Tips/Windows</a>
		</li>

		
		
		<li class="cat-item">
			<a href="http://www.dpetzel.info//categories/zenoss/index.html">Zenoss</a>
		</li>

		

	</ul>

</aside>

		<span>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:inline-block;width:120px;height:240px"
     data-ad-client="ca-pub-3085354840505663"
     data-ad-slot="7199542960"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</span>


	</div>

</div>

</div>

		</div>

		<footer id="colophon" class="site-footer" role="contentinfo">

			<div class="site-info">
				<a href="http://gohugo.io">Proudly powered by Hugo</a>
			</div>
		</footer>
	</div>

	<script type='text/javascript' src='http://www.dpetzel.info//js/functions.js'></script>
</body>
</html>
